<script type="text/discourse-plugin" version="0.8.20">
  const {
    Candidate_header_links: candidateHeaderLinks = [],
    Admin_header_links: adminHeaderLinks = [],
    Employee_header_links: employeeHeaderLinks = [],
    Default_header_links: defaultHeaderLinks = [],
  } = settings;

  const {
    admin,
    custom_fields: {
      profile_type: profileType,
    } = {},
  } = Discourse.User.current();

  const linksPosition = !profileType ? "header-buttons:before" : "home-logo:after";

  const h = require("virtual-dom").h;

  const makeLinks = linksList => {
    const headerLinks = [];

    linksList.split("|").map(i => {
      const seg = $.map(i.split(","), $.trim);
      const linkText = seg[0];
      const linkTitle = seg[1];
      const linkHref = seg[2];
      const deviceClass = `.${seg[3]}`;
      const linkTarget = seg[4] === "self" ? "" : "_blank";
      const keepOnScrollClass = seg[5] === "keep" ? ".keep" : "";
      const linkClass = `.${linkText.trim().toLowerCase().replace(/\s/gi, '-')}`;

      if (!linkTarget) {
        headerLinks.push(
          h(
            `li.headerLink${deviceClass}${keepOnScrollClass}${linkClass}`,
            h(
              "a",
              {
                title: linkTitle,
                href: linkHref
              },
              linkText
            )
          )
        );
      } else {
        headerLinks.push(
          h(
            `li.headerLink${deviceClass}${keepOnScrollClass}${linkClass}`,
            h(
              "a",
              {
                title: linkTitle,
                href: linkHref,
                target: linkTarget
              },
              linkText
            )
          )
        );
      }
    });

    api.decorateWidget(linksPosition, helper => {
      return helper.h(
        "ul.custom-header-links", headerLinks
      );
    });
  }

  if ((admin || profileType === 'RainmakersAdmin') && adminHeaderLinks.length) {
    makeLinks(adminHeaderLinks);
  }
  if (profileType === 'Candidate' && candidateHeaderLinks.length) {
    makeLinks(candidateHeaderLinks);
  }
  if (profileType === 'Employee' && employeeHeaderLinks.length) {
    makeLinks(employeeHeaderLinks);
  }

  if (!profileType && defaulHeaderLinks.length) {
    makeLinks(defaulHeaderLinks);
  }

  api.decorateWidget("home-logo:after", helper => {
    let titleVisible = helper.attrs.minimized;
    if (titleVisible) {
      $(".d-header").addClass("hide-menus");
    } else {
      $(".d-header").removeClass("hide-menus");
    }
  });
</script>
